name: OSQuerybeat
cmd: osquerybeat
args: ["-E", "setup.ilm.enabled=false", "-E", "setup.template.enabled=false", "-E", "management.mode=x-pack-fleet", "-E", "management.enabled=true", "-E", "logging.level=debug"]
rules:
- fix_stream: {}
- inject_index:
    type: logs

- inject_stream_processor:
    on_conflict: insert_after
    type: logs

- filter_values:
    selector: inputs
    key: type
    values:
    - osquery

- filter:
    selectors:
    - inputs
    - output

when: HasItems(%{[inputs]}) && HasNamespace('output', 'elasticsearch')
